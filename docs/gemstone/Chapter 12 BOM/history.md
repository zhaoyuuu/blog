# history å¯¹è±¡

éš¾åº¦ï¼šâ­ï¸

> ğŸ’Œ `history` å¯¹è±¡è¡¨ç¤ºå½“å‰çª—å£é¦–æ¬¡ä½¿ç”¨ä»¥æ¥ç”¨æˆ·çš„**å¯¼èˆªå†å²è®°å½•**ã€‚å› ä¸º `history` æ˜¯ `window` çš„å±æ€§ï¼Œæ‰€ä»¥æ¯ä¸ª `window` éƒ½æœ‰è‡ªå·±çš„ `history` å¯¹è±¡ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè¿™ä¸ªå¯¹è±¡**ä¸ä¼šæš´éœ²**ç”¨æˆ·è®¿é—®è¿‡çš„ URLï¼Œä½†å¯ä»¥é€šè¿‡å®ƒåœ¨**ä¸çŸ¥é“å®é™… URL çš„æƒ…å†µä¸‹å‰è¿›å’Œåé€€**ã€‚

## å¯¼èˆª

> æ–¹æ³•ï¼š`go()` `forward()` `back()` å±æ€§ï¼š`length`

**_ğŸ‘‰ go()_**

```js
// åé€€ä¸€é¡µ
history.go(-1);
// å‰è¿›ä¸€é¡µ
history.go(1);
// å‰è¿›ä¸¤é¡µ
history.go(2);
```

**_ğŸ‘‰ forward() & back()_**

```js
// åé€€ä¸€é¡µ
history.back();
// å‰è¿›ä¸€é¡µ
history.forward();
```

<br>

æ­¤å¤–ï¼Œ`history` å¯¹è±¡è¿˜æœ‰ä¸€ä¸ª `length` å±æ€§ï¼Œè¡¨ç¤º**å†å²è®°å½•ä¸­æœ‰å¤šä¸ªæ¡ç›®**ã€‚é€šè¿‡ä»¥ä¸‹æ–¹æ³•æµ‹è¯•è¿™ä¸ªå€¼ï¼Œå¯ä»¥ç¡®å®š**ç”¨æˆ·æµè§ˆå™¨çš„èµ·ç‚¹æ˜¯ä¸æ˜¯ä½ çš„é¡µé¢**ï¼š

```js
if (history.length == 1){
  // è¿™æ˜¯ç”¨æˆ·çª—å£ä¸­çš„ç¬¬ä¸€ä¸ªé¡µé¢
}
```

> âœ¨ `history` å¯¹è±¡é€šå¸¸è¢«ç”¨äºåˆ›å»ºâ€œåé€€â€å’Œâ€œå‰è¿›â€æŒ‰é’®ï¼Œä»¥åŠç¡®å®šé¡µé¢æ˜¯ä¸æ˜¯ç”¨æˆ·å†å²è®°å½•ä¸­çš„ç¬¬ä¸€æ¡è®°å½•ã€‚

## å†å²çŠ¶æ€ç®¡ç†

> `pushState()` `popState()` `replaceState()`

ğŸ¤” ç°ä»£ Web åº”ç”¨ç¨‹åºå¼€å‘ä¸­æœ€éš¾çš„ç¯èŠ‚ä¹‹ä¸€å°±æ˜¯å†å²è®°å½•ç®¡ç†ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆå‡ºç°çš„æ˜¯ **`hashchange` äº‹ä»¶**ã€‚HTML5 ä¹Ÿä¸º `history` å¯¹è±¡å¢åŠ äº†æ–¹ä¾¿çš„**çŠ¶æ€ç®¡ç†ç‰¹æ€§**ã€‚

`hashchange` ä¼šåœ¨é¡µé¢ URL çš„æ•£åˆ—å˜åŒ–æ—¶è¢«è§¦å‘ï¼Œå¼€å‘è€…å¯ä»¥åœ¨æ­¤æ—¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚è€Œ**çŠ¶æ€ç®¡ç† API** åˆ™å¯ä»¥è®©å¼€å‘è€…æ”¹å˜æµè§ˆå™¨ URL è€Œä¸ä¼šåŠ è½½æ–°é¡µé¢ã€‚

- å¯ä»¥ä½¿ç”¨ **`history.pushState()`** æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ 3 ä¸ªå‚æ•°ï¼šä¸€ä¸ª `state` å¯¹è±¡ã€ä¸€ä¸ªæ–°çŠ¶æ€çš„æ ‡é¢˜ å’Œ ä¸€ä¸ªï¼ˆå¯é€‰çš„ï¼‰ç›¸å¯¹ URLã€‚ä¾‹å¦‚ï¼š

```js
let stateObject = {foo:"bar"};
history.pushState(stateObject, "My title", "baz.html");
```

`pushState()`æ–¹æ³•æ‰§è¡Œåï¼ŒçŠ¶æ€ä¿¡æ¯å°±ä¼šè¢«æ¨åˆ°å†å²è®°å½•ä¸­ï¼Œæµè§ˆå™¨åœ°å€æ ä¹Ÿä¼šæ”¹å˜ä»¥åæ˜ æ–°çš„ç›¸å¯¹ URLã€‚

- å› ä¸º `pushState()` ä¼šåˆ›å»ºæ–°çš„å†å²è®°å½•ï¼Œæ‰€ä»¥ä¹Ÿä¼šç›¸åº”åœ°å¯ç”¨â€œåé€€â€æŒ‰é’®ã€‚æ­¤æ—¶å•å‡»â€œåé€€â€æŒ‰é’®ï¼Œå°±ä¼šè§¦å‘ window å¯¹è±¡ä¸Šçš„ **`popstate` äº‹ä»¶**ï¼š

```js
window.addEventListener("popstate", (event) => {
  let state = event.state;
  if (state) { // ç¬¬ä¸€ä¸ªé¡µé¢åŠ è½½æ—¶çŠ¶æ€æ˜¯ null
    processState(state);
  }
});
```

- ä¹Ÿå¯ä»¥ä½¿ç”¨ **`replaceState()`** å¹¶ä¼ å…¥ä¸ `pushState()` åŒæ ·çš„å‰ä¸¤ä¸ªå‚æ•°æ¥æ›´æ–°çŠ¶æ€ã€‚æ›´æ–°çŠ¶æ€ä¸ä¼šåˆ›å»ºæ–°å†å²è®°å½•ï¼Œåªä¼š**è¦†ç›–å½“å‰çŠ¶æ€**ï¼š

```js
history.replaceState({newFoo: "newBar"}, "New title");
```
