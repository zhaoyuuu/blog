import{_ as s,c as a,o as n,d as l}from"./app.2a74e67e.js";const i=JSON.parse('{"title":"WeakMap å¼±æ˜ å°„","description":"","frontmatter":{},"headers":[{"level":2,"title":"åŸºæœ¬ API","slug":"åŸºæœ¬-api","link":"#åŸºæœ¬-api","children":[]},{"level":2,"title":"å¼±é”®","slug":"å¼±é”®","link":"#å¼±é”®","children":[]},{"level":2,"title":"ä¸å¯è¿­ä»£é”®","slug":"ä¸å¯è¿­ä»£é”®","link":"#ä¸å¯è¿­ä»£é”®","children":[]},{"level":2,"title":"ä½¿ç”¨å¼±æ˜ å°„","slug":"ä½¿ç”¨å¼±æ˜ å°„","link":"#ä½¿ç”¨å¼±æ˜ å°„","children":[]}],"relativePath":"gemstone/Chapter 6 é›†åˆå¼•ç”¨ç±»å‹/WeakMap.md","lastUpdated":1677131280000}'),o={name:"gemstone/Chapter 6 é›†åˆå¼•ç”¨ç±»å‹/WeakMap.md"},p=l(`<h1 id="weakmap-å¼±æ˜ å°„" tabindex="-1">WeakMap å¼±æ˜ å°„ <a class="header-anchor" href="#weakmap-å¼±æ˜ å°„" aria-hidden="true">#</a></h1><p>éš¾åº¦ï¼šâ­ï¸â­ï¸</p><blockquote><p>ğŸ’Œ ECMAScript 6 æ–°å¢çš„â€œå¼±æ˜ å°„â€ï¼ˆWeakMapï¼‰æ˜¯ä¸€ç§æ–°çš„é›†åˆç±»å‹ï¼Œä¸ºè¿™é—¨è¯­è¨€å¸¦æ¥äº†<strong>å¢å¼ºçš„é”®/å€¼å¯¹å­˜å‚¨æœºåˆ¶</strong>ã€‚WeakMap æ˜¯ Map çš„â€œå…„å¼Ÿâ€ç±»å‹ï¼Œ<strong>å…¶ API ä¹Ÿæ˜¯ Map çš„å­é›†</strong>ã€‚<br> WeakMap ä¸­çš„â€œweakâ€ï¼ˆå¼±ï¼‰ï¼Œæè¿°çš„æ˜¯ JavaScript <strong>åƒåœ¾å›æ”¶ç¨‹åºå¯¹å¾…â€œå¼±æ˜ å°„â€ä¸­é”®çš„æ–¹å¼</strong>ã€‚</p></blockquote><h2 id="åŸºæœ¬-api" tabindex="-1">åŸºæœ¬ API <a class="header-anchor" href="#åŸºæœ¬-api" aria-hidden="true">#</a></h2><blockquote><p><code>set()</code> | <code>get()</code> <code>has()</code> | <code>delete()</code></p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> wm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>å¼±æ˜ å°„ä¸­çš„ <strong>â€œé”®â€: åªèƒ½æ˜¯ Object æˆ–è€…ç»§æ‰¿è‡ª Object çš„ç±»å‹</strong>ï¼Œå°è¯•ä½¿ç”¨éå¯¹è±¡è®¾ç½®é”®ä¼šæŠ›å‡º TypeErrorã€‚â€œå€¼â€çš„ç±»å‹æ²¡æœ‰é™åˆ¶ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åˆå§‹åŒ–æ˜¯å…¨æœ‰æˆ–å…¨æ— çš„æ“ä½œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åªè¦æœ‰ä¸€ä¸ªé”®æ— æ•ˆå°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå¯¼è‡´æ•´ä¸ªåˆå§‹åŒ–å¤±è´¥</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> wm2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#A6ACCD;">([</span></span>
<span class="line"><span style="color:#A6ACCD;">  [key1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">val1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">BADKEY</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">val2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  [key3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">val3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// TypeError: Invalid value used as WeakMap key</span></span>
<span class="line"><span style="color:#89DDFF;">typeof</span><span style="color:#A6ACCD;"> wm2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ReferenceError: wm2 is not defined</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åŸå§‹å€¼å¯ä»¥å…ˆåŒ…è£…æˆå¯¹è±¡å†ç”¨ä½œé”®</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> stringKey </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">key1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> wm3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#A6ACCD;">([</span></span>
<span class="line"><span style="color:#A6ACCD;">  stringKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">val1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(wm3</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(stringKey))</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// &quot;val1&quot;</span></span>
<span class="line"></span></code></pre></div><p>åˆå§‹åŒ–ä¹‹åå¯ä»¥ä½¿ç”¨ <code>set()</code> å†æ·»åŠ é”®/å€¼å¯¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>get()</code>å’Œ <code>has()</code>æŸ¥è¯¢ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>delete()</code>åˆ é™¤ï¼ˆåŒ Mapï¼‰ã€‚</p><h2 id="å¼±é”®" tabindex="-1">å¼±é”® <a class="header-anchor" href="#å¼±é”®" aria-hidden="true">#</a></h2><p>WeakMap ä¸­â€œweakâ€è¡¨ç¤ºå¼±æ˜ å°„çš„é”®æ˜¯â€œå¼±å¼±åœ°æ‹¿ç€â€çš„ã€‚æ„æ€å°±æ˜¯ï¼Œ<strong>è¿™äº›é”®ä¸å±äºæ­£å¼çš„å¼•ç”¨ï¼Œä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶</strong>ã€‚<br>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å¼±æ˜ å°„ä¸­å€¼çš„å¼•ç”¨å¯ä¸æ˜¯â€œå¼±å¼±åœ°æ‹¿ç€â€çš„</strong>ã€‚åªè¦é”®å­˜åœ¨ï¼Œé”®/å€¼å¯¹å°±ä¼šå­˜åœ¨äºæ˜ å°„ä¸­ï¼Œå¹¶è¢«å½“ä½œå¯¹å€¼çš„å¼•ç”¨ï¼Œå› æ­¤å°±ä¸ä¼šè¢«å½“ä½œåƒåœ¾å›æ”¶ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> wm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> container </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">wm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;">(container</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">removeReference</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>container</code> å¯¹è±¡ç»´æŠ¤ç€ä¸€ä¸ªå¯¹å¼±æ˜ å°„é”®çš„å¼•ç”¨ï¼Œå› æ­¤è¿™ä¸ª<strong>å¯¹è±¡é”®ä¸ä¼šæˆä¸ºåƒåœ¾å›æ”¶çš„ç›®æ ‡</strong>ã€‚ä¸è¿‡ï¼Œå¦‚æœè°ƒç”¨äº† <code>removeReference()</code>ï¼Œå°±ä¼š<strong>æ‘§æ¯é”®å¯¹è±¡çš„æœ€åä¸€ä¸ªå¼•ç”¨</strong>ï¼Œåƒåœ¾å›æ”¶ç¨‹åºå°±å¯ä»¥æŠŠè¿™ä¸ªé”®/å€¼å¯¹æ¸…ç†æ‰ã€‚</p><h2 id="ä¸å¯è¿­ä»£é”®" tabindex="-1">ä¸å¯è¿­ä»£é”® <a class="header-anchor" href="#ä¸å¯è¿­ä»£é”®" aria-hidden="true">#</a></h2><p>å› ä¸º WeakMap ä¸­çš„é”®/å€¼å¯¹ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«é”€æ¯(GC)ï¼Œæ‰€ä»¥æ²¡å¿…è¦æä¾›è¿­ä»£å…¶é”®/å€¼å¯¹çš„èƒ½åŠ›ã€‚å½“ç„¶ï¼Œä¹Ÿç”¨ä¸ç€åƒ <code>clear()</code>è¿™æ ·ä¸€æ¬¡æ€§é”€æ¯æ‰€æœ‰é”®/å€¼çš„æ–¹æ³•ã€‚</p><p>WeakMap å®ä¾‹ä¹‹æ‰€ä»¥é™åˆ¶åªèƒ½ç”¨å¯¹è±¡ä½œä¸ºé”®ï¼Œæ˜¯ä¸ºäº†ä¿è¯<strong>åªæœ‰é€šè¿‡é”®å¯¹è±¡çš„å¼•ç”¨æ‰èƒ½å–å¾—å€¼</strong>ã€‚</p><blockquote><p>å¦‚æœå…è®¸åŸå§‹å€¼ï¼Œé‚£å°±æ²¡åŠæ³•åŒºåˆ†<strong>åˆå§‹åŒ–æ—¶</strong>ä½¿ç”¨çš„å­—ç¬¦ä¸²å­—é¢é‡å’Œ<strong>åˆå§‹åŒ–ä¹‹å</strong>ä½¿ç”¨çš„ä¸€ä¸ªç›¸ç­‰çš„å­—ç¬¦ä¸²äº†ã€‚</p></blockquote><h2 id="ä½¿ç”¨å¼±æ˜ å°„" tabindex="-1">ä½¿ç”¨å¼±æ˜ å°„ <a class="header-anchor" href="#ä½¿ç”¨å¼±æ˜ å°„" aria-hidden="true">#</a></h2><ul><li><p>ç§æœ‰å˜é‡ï¼ˆç•¥ï¼‰</p></li><li><p>DOM èŠ‚ç‚¹å…ƒæ•°æ®</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> m </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Map</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> loginButton </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç»™è¿™ä¸ªèŠ‚ç‚¹å…³è”ä¸€äº›å…ƒæ•°æ®</span></span>
<span class="line"><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;">(loginButton</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">disabled</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>âŒ å‡è®¾åœ¨ä¸Šé¢çš„ä»£ç æ‰§è¡Œåï¼Œé¡µé¢è¢« JavaScript æ”¹å˜äº†ï¼Œ<strong>åŸæ¥çš„ç™»å½•æŒ‰é’®ä» DOM æ ‘ä¸­è¢«åˆ æ‰äº†</strong>ã€‚ä½†ç”±äºæ˜ å°„ä¸­è¿˜ä¿å­˜ç€æŒ‰é’®çš„å¼•ç”¨ï¼Œæ‰€ä»¥<strong>å¯¹åº”çš„ DOM èŠ‚ç‚¹ä»ç„¶ä¼šé€—ç•™åœ¨å†…å­˜ä¸­</strong>ï¼Œé™¤éæ˜ç¡®å°†å…¶ä»æ˜ å°„ä¸­åˆ é™¤æˆ–è€…ç­‰åˆ°æ˜ å°„æœ¬èº«è¢«é”€æ¯ã€‚<br><br> âœ”ï¸ å¦‚æœè¿™é‡Œä½¿ç”¨çš„æ˜¯<strong>å¼±æ˜ å°„</strong>ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼Œé‚£ä¹ˆå½“èŠ‚ç‚¹ä» DOM æ ‘ä¸­è¢«åˆ é™¤åï¼Œ<strong>åƒåœ¾å›æ”¶ç¨‹åºå°±å¯ä»¥ç«‹å³é‡Šæ”¾å…¶å†…å­˜</strong>ï¼ˆå‡è®¾æ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼‰ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> wm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> loginButton </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç»™è¿™ä¸ªèŠ‚ç‚¹å…³è”ä¸€äº›å…ƒæ•°æ®</span></span>
<span class="line"><span style="color:#A6ACCD;">wm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;">(loginButton</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">disabled</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div></li></ul>`,19),e=[p];function t(c,r,D,y,A,F){return n(),a("div",null,e)}const d=s(o,[["render",t]]);export{i as __pageData,d as default};
